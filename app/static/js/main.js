import{io as e}from"https://cdn.socket.io/4.4.1/socket.io.esm.min.js";window.mdata=null,(()=>{let t=document.querySelector("#message-form"),s=document.querySelector("#message-to-send"),n=document.querySelector("#message-send-btn"),a=document.querySelector("#message-attach-file"),l=document.querySelector("#connect-btn"),r=document.querySelector("#disconnect-btn"),d=document.querySelector("#dl-mode-btn"),i={bg:"#222",fg:"#eee"};function o(e){return e<1024?`${e} bytes`:e>=1024&&e<1048576?`${(e/1024).toFixed(1)} KB`:e>=1048576?`${(e/1048576).toFixed(1)} MB`:void 0}let c=document.querySelector("#message-container"),m=()=>{l.disabled=!0},u=(e="start")=>{s.disabled="start"!==e,n.disabled="start"!==e,a.disabled="start"!==e,r.disabled="start"!==e,l.disabled="start"===e,s.value=""},g=()=>{c.innerHTML=""},f=e=>{let t=document.createElement("div");return t.textContent=e,t.classList.add("msg"),t},p=e=>{let t=document.createElement("div");t.className="file msg recv";let s=document.createElement("div");s.className="upper-head",s.innerHTML=(e.s_name||"Me")+":";let n=document.createElement("div");n.className="inner-file";let a=document.createElement("div");a.className="name-size";let l=document.createElement("span");l.innerText=e.name;let r=document.createElement("span");r.innerText=" ("+e.size+")",a.append(l,r);let d=document.createElement("div");d.className="type",d.innerText=e.mimetype,n.append(s,a,d);let i=document.createElement("a");return i.className="file-dl-link",i.textContent="Download",i.href=e.data,i.setAttribute("download",e.name),t.append(n,i),t},y=()=>c.childNodes.length>0?c.childNodes[0]:null,v=e=>{let t=y();null===t?c.append(e):t.insertAdjacentElement("beforebegin",e),c.scrollTo({top:c.scrollHeight,behavior:"smooth"})},b=e=>{if("text"===e.mimetype){let t=f(`Me: ${e.data}`);t.classList.add("sent"),v(t)}else{let s=p(e);s.classList.add("sent"),v(s)}},$=(e,t)=>{if("text"===t.mimetype){let n=f(`${e}: ${t.data}`);n.classList.add("recv"),v(n),s.focus()}else{let a=p(t);a.classList.add("recv"),v(a),s.focus()}},E=e=>{let t=f(e);t.classList.add("status"),v(t)},L=()=>{let n=null;l.addEventListener("click",t=>{n||(m(),(n=e()).on("join-user",e=>{"found"===e.status&&(g(),u())}),n.on("disconnect",e=>{u("end"),n.disconnect(),n=null}),n.on("new-message",e=>{$(e.s_name,e,e)}),n.on("status-message",e=>{E(e.message)}),n.on("error",e=>{console.log(e)}),n.on("my error",e=>{console.log(e)}))}),r.addEventListener("click",e=>{n&&(u("end"),n.disconnect(),n=null,E("You're disconnected!"))}),t.addEventListener("submit",e=>{if(e.preventDefault(),!n)return;s.focus();let a=s.value;if(!a){E("Could not send an empty message!");return}n.emit("send-message",{mimetype:"text",data:a},e=>{b({mimetype:"text",data:a}),s.textContent="",s.value="",t.focus()})}),a.addEventListener("change",async e=>{let a=e.target.files;if(a.length>0){let l=a[0];if(l.size>1e7){alert("File must be smaller than 10MBs");return}let r;var d=new FileReader;d.readAsDataURL(l),d.onload=function(e){r=e.target.result.toString();let a={mimetype:l.type,name:l.name,size:o(l.size),data:r};n.emit("send-message",a,e=>{b(a),s.textContent="",s.value="",t.focus()})};return}}),d.addEventListener("click",e=>{e.preventDefault(),document.documentElement.style.setProperty("--fg",i.bg),document.documentElement.style.setProperty("--bg",i.fg);let t=i.fg;i.fg=i.bg,i.bg=t})};L()})();